#!/usr/bin/env bash

# Install nginx on your web-01 server
# Nginx should be listening on port 80
# When querying Nginx at its root / with a GET request (requesting a page)
# using curl, it must return a page that contains the string Hello World!

# Check if the script is run as root
if [ "$EUID" -ne 0 ]; then
    echo "Please run this script as root."
    exit 1
fi

# Update the package list
apt-get update

# Install Nginx
apt-get install -y nginx

# Create a basic HTML file with "Hello World!"
echo "Hello World!" > /var/www/html/index.html

# Restart Nginx (without using systemctl)
service nginx restart

# Ensure Nginx is listening on port 80
if ! (netstat -tuln | grep -q ':80 '); then
    echo "Nginx is not listening on port 80."
    exit 1
fi

# Test Nginx by querying it with curl
response=$(curl -s http://localhost)
if [[ "$response" == *"Hello World!"* ]]; then
    echo "Nginx is installed and configured correctly."
else
    echo "Nginx configuration test failed."
fi
